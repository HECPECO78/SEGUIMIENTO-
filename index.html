<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento Alumnos - Rotaci√≥n Talleres</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f3ff 0%, #e0e7ff 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-title h1 {
            color: #4f46e5;
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header-title p {
            color: #6b7280;
            font-size: 14px;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #4f46e5;
            color: white;
        }

        .btn-primary:hover {
            background: #4338ca;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .form-nuevo {
            background: #eef2ff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .form-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .form-row input,
        .form-row select {
            flex: 1;
            min-width: 150px;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .alumnos-group {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 15px;
        }

        .alumnos-group h3 {
            color: #312e81;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .alumno-btn {
            width: 100%;
            padding: 10px;
            background: #f9fafb;
            border: none;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            margin-bottom: 5px;
            transition: all 0.3s;
        }

        .alumno-btn:hover {
            background: #f3f4f6;
        }

        .alumno-btn.active {
            background: #eef2ff;
            color: #4f46e5;
            font-weight: 600;
        }

        .content-area {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .placeholder {
            text-align: center;
            padding: 80px 20px;
            color: #9ca3af;
        }

        .placeholder svg {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            opacity: 0.3;
        }

        .alumno-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
        }

        .alumno-info h2 {
            font-size: 22px;
            margin-bottom: 5px;
        }

        .alumno-info p {
            color: #4f46e5;
            font-size: 14px;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
            padding: 8px 12px;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        .semanas-nav {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .semana-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            background: #f3f4f6;
            transition: all 0.3s;
        }

        .semana-btn.active {
            background: #4f46e5;
            color: white;
        }

        .dias-header {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            margin-bottom: 15px;
        }

        .dia-label {
            text-align: center;
            font-weight: 600;
            background: #f9fafb;
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
        }

        .categoria {
            margin-bottom: 15px;
        }

        .categoria-header {
            background: #eef2ff;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 14px;
        }

        .categoria-content {
            display: none;
            padding-top: 10px;
        }

        .categoria-content.expanded {
            display: block;
        }

        .aspecto {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .aspecto-nombre {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .aspecto-dias {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
        }

        .aspecto-dias select {
            width: 100%;
            padding: 6px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 12px;
        }

        .notas-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 20px;
            margin-top: 20px;
        }

        .notas-section h3 {
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .notas-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .notas-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }

        .notas-lista {
            max-height: 150px;
            overflow-y: auto;
        }

        .nota-item {
            background: #fef3c7;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .nota-fecha {
            color: #6b7280;
            font-size: 11px;
            margin-top: 5px;
        }

        .comentarios-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 20px;
            margin-top: 20px;
        }

        .comentarios-btns {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .btn-comentario {
            padding: 15px;
            background: #4f46e5;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-comentario:hover {
            background: #4338ca;
        }

        .btn-comentario.mensual {
            background: #7c3aed;
        }

        .btn-comentario.mensual:hover {
            background: #6d28d9;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 18px;
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .modal-body pre {
            white-space: pre-wrap;
            font-size: 13px;
            font-family: inherit;
            line-height: 1.6;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }

        .tareas-section {
            background: #f9fafb;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }

        .tareas-toggle {
            background: #eef2ff;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .tareas-content {
            display: none;
        }

        .tareas-content.expanded {
            display: block;
        }

        .taller-group {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 2px solid #e5e7eb;
        }

        .taller-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .taller-titulo {
            font-size: 16px;
            font-weight: 600;
            color: #4f46e5;
        }

        .tarea-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
        }

        .tarea-titulo {
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .tarea-criterios {
            font-size: 12px;
            color: #6b7280;
            margin-top: 5px;
        }

        .criterio-tag {
            display: inline-block;
            background: #eef2ff;
            color: #4f46e5;
            padding: 3px 8px;
            border-radius: 4px;
            margin: 2px;
            font-size: 11px;
        }

        .form-tarea {
            background: #eef2ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .form-group {
            margin-bottom: 10px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .criterios-inputs {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .rotacion-section {
            background: #fef3c7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid #f59e0b;
        }

        .rotacion-label {
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
            font-size: 14px;
            color: #92400e;
        }

        .rotacion-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            background: white;
            margin-bottom: 10px;
        }

        .tarea-select-section {
            background: #dbeafe;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .tarea-select-label {
            font-weight: 600;
            margin-bottom: 6px;
            display: block;
            font-size: 13px;
            color: #1e40af;
        }

        .tarea-select {
            width: 100%;
            padding: 8px;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
        }

        .info-banner {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 13px;
        }

        .tipo-tarea {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
        }
        .tipo-original {
            background: #e0e7ff;
            color: #3730a3;
        }
        .tipo-nueva {
            background: #fef3c7;
            color: #92400e;
        }

        .desplegable-tipo {
            margin-bottom: 15px;
        }

        .desplegable-header {
            background: #f8fafc;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 13px;
            border: 1px solid #e2e8f0;
        }

        .desplegable-content {
            display: none;
            padding-top: 10px;
        }

        .desplegable-content.expanded {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="header-title">
                    <h1>üîÑ Seguimiento - Rotaci√≥n de Talleres</h1>
                    <p id="contador-alumnos">0 alumnos</p>
                </div>
                <div class="header-buttons">
                    <button class="btn btn-warning" onclick="cargarTodasActividades()">
                        üì• Cargar Todas
                    </button>
                    <button class="btn btn-primary" onclick="toggleFormTareas()">
                        üîß Ver Tareas
                    </button>
                    <button class="btn btn-primary" onclick="toggleFormNuevo()">
                        ‚ûï Alumno
                    </button>
                    <button class="btn btn-success" onclick="exportar()" id="btn-exportar">
                        üíæ Exportar
                    </button>
                </div>
            </div>

            <!-- Formulario gesti√≥n tareas (colapsable) -->
            <div id="form-tareas" style="display: none;">
                <div class="tareas-section">
                    <div class="tareas-toggle" onclick="toggleTareasContent()">
                        <span>üìã Banco de Tareas por Taller</span>
                        <span id="tareas-arrow">‚ñº</span>
                    </div>
                    
                    <div class="tareas-content" id="tareas-content">
                        <div id="form-nueva-tarea" style="display: none;">
                            <div class="form-tarea">
                                <div class="form-group">
                                    <label>Taller:</label>
                                    <select id="nueva-tarea-taller">
                                        <option>Electricidad</option>
                                        <option>Fontaner√≠a</option>
                                        <option>Carpinter√≠a</option>
                                        <option>Alba√±iler√≠a</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Nombre de la tarea:</label>
                                    <input type="text" id="nueva-tarea-nombre" placeholder="Ej: Instalaci√≥n de enchufes">
                                </div>
                                <div class="form-group">
                                    <label>Criterios de evaluaci√≥n:</label>
                                    <div class="criterios-inputs" id="criterios-inputs">
                                        <input type="text" placeholder="Criterio 1" class="criterio-input">
                                        <input type="text" placeholder="Criterio 2" class="criterio-input">
                                        <input type="text" placeholder="Criterio 3" class="criterio-input">
                                    </div>
                                    <button class="btn btn-secondary btn-small" style="margin-top: 5px;" onclick="agregarCriterioInput()">+ A√±adir criterio</button>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-primary" onclick="guardarTarea()">Guardar Tarea</button>
                                    <button class="btn btn-secondary" onclick="toggleFormNuevaTarea()">Cancelar</button>
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-primary btn-small" style="margin-bottom: 15px;" onclick="toggleFormNuevaTarea()">‚ûï Nueva Tarea Manual</button>

                        <div id="lista-tareas"></div>
                    </div>
                </div>
            </div>

            <!-- Formulario nuevo alumno -->
            <div id="form-nuevo" class="form-nuevo" style="display: none;">
                <div class="form-row">
                    <input type="text" id="nombre-nuevo" placeholder="Nombre del alumno" onkeypress="if(event.key==='Enter')agregarAlumno()">
                    <button class="btn btn-primary" onclick="agregarAlumno()">Agregar</button>
                    <button class="btn btn-secondary" onclick="toggleFormNuevo()">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="alumnos-group">
                    <h3>üë• Alumnos</h3>
                    <div id="lista-alumnos"></div>
                </div>
            </div>

            <!-- Content Area -->
            <div id="content-area">
                <div class="content-area">
                    <div class="placeholder">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <p>Selecciona un alumno para comenzar el seguimiento</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Comentario -->
    <div id="modal-comentario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìù Comentario</h3>
                <button class="btn-close" onclick="cerrarModal()">&times;</button>
            </div>
            <div class="modal-body">
                <pre id="texto-comentario"></pre>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" style="width: 100%;" onclick="copiarComentario()">üìã Copiar al Portapapeles</button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let alumnos = [];
        let tareas = [];
        let notas = {};
        let seleccionado = null;
        let semanaActual = 1;
        let categoriaExpandida = 'actitudinales';
        let tareasExpanded = false;

        const talleres = ['Electricidad', 'Fontaner√≠a', 'Carpinter√≠a', 'Alba√±iler√≠a'];

        // ACTIVIDADES ORIGINALES COMPLETAS
        const actividadesElectricidadOriginal = [
            {
                nombre: "ACT1: Herramientas b√°sicas (destornilladores, alicates, pelacables)",
                criterios: [
                    "Identificaci√≥n correcta de herramientas",
                    "T√©cnica de uso de destornilladores",
                    "Manejo de alicates y pelacables",
                    "Pelado y preparaci√≥n de cables",
                    "Mantenimiento de herramientas"
                ]
            },
            {
                nombre: "ACT2: Instrumentos de medida (volt√≠metro, amper√≠metro)",
                criterios: [
                    "Uso correcto del mult√≠metro",
                    "Medici√≥n de tensi√≥n y corriente",
                    "Pruebas de continuidad",
                    "Uso de pinzas amperim√©tricas",
                    "Interpretaci√≥n de medidas"
                ]
            },
            {
                nombre: "ACT3: Equipos de protecci√≥n individual (EPIs)",
                criterios: [
                    "Selecci√≥n de EPIs adecuados",
                    "Uso correcto de guantes diel√©ctricos",
                    "Verificaci√≥n de herramientas aisladas",
                    "Mantenimiento de EPIs",
                    "Aplicaci√≥n de normativa de seguridad"
                ]
            },
            {
                nombre: "ACT4: Riesgos el√©ctricos b√°sicos",
                criterios: [
                    "Identificaci√≥n de riesgos el√©ctricos",
                    "Diferenciaci√≥n contactos directos/indirectos",
                    "Reconocimiento de situaciones peligrosas",
                    "Conocimiento de primeros auxilios",
                    "Aplicaci√≥n de medidas preventivas"
                ]
            },
            {
                nombre: "ACT5: Procedimientos de seguridad (5 reglas de oro)",
                criterios: [
                    "Aplicaci√≥n de las 5 reglas de oro",
                    "Procedimiento de consignaci√≥n",
                    "Uso de detectores de tensi√≥n",
                    "Se√±alizaci√≥n de zonas de trabajo",
                    "Verificaci√≥n de ausencia de tensi√≥n"
                ]
            },
            {
                nombre: "ACT6: Simbolog√≠a el√©ctrica b√°sica",
                criterios: [
                    "Reconocimiento de s√≠mbolos normalizados",
                    "Dibujo de s√≠mbolos correctamente",
                    "Aplicaci√≥n de normativa UNE/IEC",
                    "Interpretaci√≥n de esquemas",
                    "Uso de herramientas de dibujo t√©cnico"
                ]
            },
            {
                nombre: "ACT7: Interpretaci√≥n de planos unifilares",
                criterios: [
                    "Lectura de esquemas unifilares",
                    "Identificaci√≥n de circuitos de potencia",
                    "Interpretaci√≥n de protecciones",
                    "C√°lculos b√°sicos de intensidades",
                    "Detecci√≥n de errores en esquemas"
                ]
            },
            {
                nombre: "ACT8: Circuitos de alumbrado completos",
                criterios: [
                    "Montaje de punto de luz simple",
                    "Circuito conmutado (2 puntos)",
                    "Circuito de cruzamiento (3+ puntos)",
                    "Instalaci√≥n de temporizadores",
                    "Verificaci√≥n y pruebas de funcionamiento"
                ]
            },
            {
                nombre: "ACT9: Circuitos de enchufes y fuerza",
                criterios: [
                    "Montaje de bases schuko",
                    "Conexionado correcto con tierra",
                    "Instalaci√≥n de protecci√≥n diferencial",
                    "Enchufes especiales (ba√±o/exterior)",
                    "Verificaci√≥n con comprobador"
                ]
            },
            {
                nombre: "ACT10: Instalaci√≥n mixta y cuadro de distribuci√≥n",
                criterios: [
                    "Dise√±o de instalaci√≥n completa",
                    "C√°lculo de secciones de conductores",
                    "Montaje del cuadro el√©ctrico",
                    "Conexionado de l√≠neas",
                    "Etiquetado y puesta en servicio"
                ]
            }
        ];

        const actividadesFontaneriaOriginal = [
            {
                nombre: "ACT1: Herramientas de fontaner√≠a (llaves, cortatubos, soplete)",
                criterios: [
                    "Identificaci√≥n correcta de herramientas",
                    "Uso de llaves inglesas y estilson",
                    "T√©cnica de corte de tubos",
                    "Manejo de soplete para soldadura",
                    "Mantenimiento de herramientas"
                ]
            },
            {
                nombre: "ACT2: Tipos de tuber√≠as y conexiones",
                criterios: [
                    "Diferenciaci√≥n PVC, cobre, PEX",
                    "Elecci√≥n de conexiones adecuadas",
                    "T√©cnicas de uni√≥n por rosca",
                    "Soldadura de tuber√≠as de cobre",
                    "Pruebas de estanqueidad"
                ]
            },
            {
                nombre: "ACT3: Instalaci√≥n de sanitarios",
                criterios: [
                    "Montaje de inodoro completo",
                    "Instalaci√≥n de lavabo y grifer√≠a",
                    "Conexi√≥n de desag√ºes y sifones",
                    "Nivelaci√≥n y fijaci√≥n correcta",
                    "Pruebas de funcionamiento"
                ]
            },
            {
                nombre: "ACT4: Sistemas de desag√ºe y ventilaci√≥n",
                criterios: [
                    "C√°lculo de pendientes de desag√ºe",
                    "Instalaci√≥n de bajantes",
                    "Sistema de ventilaci√≥n primaria",
                    "Prevenci√≥n de sifonamiento",
                    "Pruebas de drenaje correcto"
                ]
            },
            {
                nombre: "ACT5: Detecci√≥n y reparaci√≥n de fugas",
                criterios: [
                    "Localizaci√≥n de fugas",
                    "Reparaci√≥n de juntas y empaquetaduras",
                    "Sustituci√≥n de secciones da√±adas",
                    "Uso de cintas y pastas sellantes",
                    "Verificaci√≥n final de estanqueidad"
                ]
            },
            {
                nombre: "ACT6: Instalaci√≥n de grifer√≠a monomando",
                criterios: [
                    "Desmontaje de grifer√≠a antigua",
                    "Preparaci√≥n de superficies",
                    "Colocaci√≥n de juntas y arandelas",
                    "Ajuste de caudal y temperatura",
                    "Pruebas de estanqueidad y funcionamiento"
                ]
            },
            {
                nombre: "ACT7: Montaje de calentador el√©ctrico",
                criterios: [
                    "Elecci√≥n de ubicaci√≥n adecuada",
                    "Fijaci√≥n a pared de forma segura",
                    "Conexiones de agua fr√≠a/caliente",
                    "Conexi√≥n el√©ctrica con protecci√≥n",
                    "Puesta en marcha y regulaci√≥n"
                ]
            },
            {
                nombre: "ACT8: Instalaci√≥n de desag√ºe de lavadora",
                criterios: [
                    "C√°lculo de desag√ºe sif√≥nico",
                    "Instalaci√≥n de v√°lvula antiretorno",
                    "Conexi√≥n a bajante principal",
                    "Pruebas de caudal y estanqueidad",
                    "Ajuste de nivelaci√≥n de m√°quina"
                ]
            }
        ];

        const actividadesCarpinteriaOriginal = [
            {
                nombre: "ACT1: Herramientas manuales (sierras, cepillos, formones)",
                criterios: [
                    "Identificaci√≥n correcta de herramientas",
                    "T√©cnica de corte con sierras",
                    "Uso de cepillos para cepillado",
                    "Manejo de formones para ensambles",
                    "Afilado y mantenimiento"
                ]
            },
            {
                nombre: "ACT2: Medici√≥n y marcaje preciso",
                criterios: [
                    "Uso de metros y escuadras",
                    "T√©cnicas de trazado exacto",
                    "Transferencia de medidas",
                    "Verificaci√≥n de √°ngulos",
                    "Precisi√≥n en cortes"
                ]
            },
            {
                nombre: "ACT3: Ensambles b√°sicos (cola, clavos, tornillos)",
                criterios: [
                    "Preparaci√≥n de superficies",
                    "Aplicaci√≥n correcta de cola",
                    "Elecci√≥n de clavos y tornillos",
                    "T√©cnicas de atornillado",
                    "Acabado de uniones"
                ]
            },
            {
                nombre: "ACT4: Trabajo con madera maciza",
                criterios: [
                    "Selecci√≥n de maderas adecuadas",
                    "Respeto por vetas y direcci√≥n",
                    "T√©cnicas de cepillado manual",
                    "Uniones en madera maciza",
                    "Acabados naturales"
                ]
            },
            {
                nombre: "ACT5: Proyecto pr√°ctico (estanter√≠a o caja)",
                criterios: [
                    "Interpretaci√≥n de plano simple",
                    "C√°lculo de materiales necesarios",
                    "Secuencia correcta de montaje",
                    "Calidad de acabados finales",
                    "Funcionalidad del producto"
                ]
            },
            {
                nombre: "ACT6: Uso de herramientas el√©ctricas port√°tiles",
                criterios: [
                    "Manejo seguro de taladro",
                    "Uso de sierra caladora",
                    "T√©cnicas con lijadora orbital",
                    "Ajuste de velocidades y potencias",
                    "Mantenimiento b√°sico de herramientas"
                ]
            },
            {
                nombre: "ACT7: Construcci√≥n de marco para cuadro",
                criterios: [
                    "Corte de √°ngulos a 45 grados",
                    "Ensamblaje con ingletes",
                    "Refuerzo de esquinas",
                    "Acabado con lija y barniz",
                    "Montaje final con vidrio y soporte"
                ]
            },
            {
                nombre: "ACT8: Reparaci√≥n de mueble con da√±os",
                criterios: [
                    "Diagn√≥stico de da√±os",
                    "Desmontaje de partes afectadas",
                    "Sustituci√≥n de elementos rotos",
                    "Refuerzo de estructura",
                    "Acabado uniforme con pintura/barniz"
                ]
            }
        ];

        const actividadesAlbanileriaOriginal = [
            {
                nombre: "ACT1: Herramientas de alba√±iler√≠a (paletas, niveles, plomadas)",
                criterios: [
                    "Identificaci√≥n correcta de herramientas",
                    "Uso de paletas para mortero",
                    "Manejo de niveles y plomadas",
                    "T√©cnicas de aplomado",
                    "Limpieza y mantenimiento"
                ]
            },
            {
                nombre: "ACT2: Preparaci√≥n de morteros y pastas",
                criterios: [
                    "Proporciones correctas cemento/arena",
                    "Mezclado homog√©neo",
                    "Control de consistencia",
                    "Tiempos de fraguado",
                    "Limpieza de herramientas"
                ]
            },
            {
                nombre: "ACT3: Asentado de ladrillos y bloques",
                criterios: [
                    "Tendido de hiladas niveladas",
                    "Control de juntas horizontales",
                    "Aplomado de paramentos",
                    "Llenado de juntas verticales",
                    "Aspecto final del muro"
                ]
            },
            {
                nombre: "ACT4: Revoques y enlucidos",
                criterios: [
                    "Preparaci√≥n de superficie",
                    "Aplicaci√≥n de capa de agarre",
                    "T√©cnica de revocado manual",
                    "Regleado y alisado",
                    "Acabado superficial"
                ]
            },
            {
                nombre: "ACT5: Solados y alicatados",
                criterios: [
                    "Preparaci√≥n de lecho de arena",
                    "Nivelaci√≥n de base",
                    "Colocaci√≥n de baldosas",
                    "Control de juntas",
                    "Limpieza final"
                ]
            },
            {
                nombre: "ACT6: Construcci√≥n de tabique de ladrillo",
                criterios: [
                    "Trazo y replanteo en planta",
                    "Asentado de primera hilada",
                    "Control de plomos y niveles",
                    "Encuentros con paredes existentes",
                    "Acabado de juntas"
                ]
            },
            {
                nombre: "ACT7: Reparaci√≥n de grietas y desconchones",
                criterios: [
                    "Preparaci√≥n de superficie da√±ada",
                    "Aplicaci√≥n de imprimaci√≥n",
                    "Relleno con mortero de reparaci√≥n",
                    "Alisado y texturizado",
                    "Acabado para pintura"
                ]
            },
            {
                nombre: "ACT8: Instalaci√≥n de azulejos en pared",
                criterios: [
                    "Planeado de distribuci√≥n",
                    "Corte preciso de piezas",
                    "Aplicaci√≥n de adhesivo cer√°mico",
                    "Colocaci√≥n con cruceros",
                    "Rejuntado y limpieza final"
                ]
            }
        ];

        // NUEVAS ACTIVIDADES DEL PDF COMPLETAS
        const actividadesElectricidadNuevas = [
            {
                nombre: "E1: Descifrando el C√≥digo El√©ctrico",
                criterios: [
                    "Identificaci√≥n equipos y herramientas",
                    "Uso seguro de herramientas el√©ctricas",
                    "Interpretaci√≥n de normativa b√°sica",
                    "Reconocimiento de componentes el√©ctricos",
                    "Preparaci√≥n del √°rea de trabajo"
                ]
            },
            {
                nombre: "E2: El Laberinto de Tubos",
                criterios: [
                    "Planificaci√≥n de rutas de canalizaci√≥n",
                    "Corte y curvado de tubos",
                    "Fijaci√≥n correcta de soportes",
                    "Instalaci√≥n de cajas de registro",
                    "Verificaci√≥n de continuidad de canalizaciones"
                ]
            },
            {
                nombre: "E3: Tejiendo la Red",
                criterios: [
                    "Tendido correcto de conductores",
                    "Identificaci√≥n de colores normalizados",
                    "Conexionado en derivaciones",
                    "Uso de regletas de conexi√≥n",
                    "Verificaci√≥n de continuidad el√©ctrica"
                ]
            },
            {
                nombre: "E4: El Panel de Control",
                criterios: [
                    "Montaje de cuadro el√©ctrico",
                    "Instalaci√≥n de diferencial y magnetot√©rmicos",
                    "Conexionado de bornas principales",
                    "Identificaci√≥n de circuitos",
                    "Pruebas de funcionamiento del cuadro"
                ]
            },
            {
                nombre: "E5: Encendiendo la Magia",
                criterios: [
                    "Instalaci√≥n de mecanismos (enchufes, interruptores)",
                    "Conexionado correcto fase-neutro-tierra",
                    "Nivelaci√≥n y fijaci√≥n de mecanismos",
                    "Pruebas de funcionamiento",
                    "Acabado y colocaci√≥n de placas"
                ]
            },
            {
                nombre: "E6: Los 5 Circuitos Obligatorios",
                criterios: [
                    "Circuito de alumbrado b√°sico",
                    "Circuito de enchufes de uso general",
                    "Circuito de cocina y horno",
                    "Circuito de ba√±o y zonas h√∫medas",
                    "Circuito de lavadero y lavavajillas"
                ]
            },
            {
                nombre: "E7: Luz en Cada Rinc√≥n",
                criterios: [
                    "Instalaci√≥n de puntos de luz",
                    "Montaje de portal√°mparas y plafones",
                    "Conexionado de conmutados",
                    "Instalaci√≥n de detectores de movimiento",
                    "Regulaci√≥n de intensidad con dimer"
                ]
            },
            {
                nombre: "E8: Verificando la Seguridad",
                criterios: [
                    "Comprobaci√≥n de continuidad de tierra",
                    "Medici√≥n de aislamiento",
                    "Verificaci√≥n de sensibilidad diferencial",
                    "Comprobaci√≥n de polaridad",
                    "Documentaci√≥n de certificado el√©ctrico"
                ]
            },
            {
                nombre: "E9: Coordinaci√≥n con Fontaner√≠a",
                criterios: [
                    "Identificaci√≥n de cruces con instalaciones de agua",
                    "Respeto de distancias de seguridad",
                    "Coordinaci√≥n con otros oficios",
                    "Planificaci√≥n de rutas evitando conflictos",
                    "Comunicaci√≥n efectiva con equipo"
                ]
            },
            {
                nombre: "E10: MI PRIMERA INSTALACI√ìN EL√âCTRICA COMPLETA",
                criterios: [
                    "Planificaci√≥n integral de la instalaci√≥n",
                    "Ejecuci√≥n de todos los circuitos",
                    "Montaje completo del cuadro el√©ctrico",
                    "Verificaci√≥n de todas las protecciones",
                    "Puesta en servicio y entrega final"
                ]
            }
        ];

        const actividadesFontaneriaNuevas = [
            {
                nombre: "F1: El Fontanero Ilustrado",
                criterios: [
                    "Identificaci√≥n de materiales y herramientas",
                    "Diferenciaci√≥n tipos de tuber√≠as",
                    "Selecci√≥n de materiales adecuados",
                    "Organizaci√≥n del almac√©n",
                    "Preparaci√≥n de lista de materiales"
                ]
            },
            {
                nombre: "F2: Domando el PEX",
                criterios: [
                    "Corte preciso de tuber√≠as PEX",
                    "Uso de herramientas de prensado",
                    "Realizaci√≥n de uniones estancas",
                    "Instalaci√≥n de abrazaderas y soportes",
                    "Pruebas de presi√≥n iniciales"
                ]
            },
            {
                nombre: "F3: La Multicapa Perfecta",
                criterios: [
                    "Trabajo con tuber√≠as multicapa",
                    "Realizaci√≥n de curvados precisos",
                    "Uso de herramientas de corte espec√≠ficas",
                    "Instalaci√≥n de juntas y accesorios",
                    "Montaje en instalaciones de calefacci√≥n"
                ]
            },
            {
                nombre: "F4: El Gran Desag√ºe",
                criterios: [
                    "Instalaci√≥n de bajantes y desag√ºes",
                    "C√°lculo de pendientes correctas",
                    "Montaje de sifones y v√°lvulas",
                    "Sistema de ventilaci√≥n primaria",
                    "Pruebas de estanqueidad en desag√ºes"
                ]
            },
            {
                nombre: "F5: Agua Caliente 24/7",
                criterios: [
                    "Instalaci√≥n de calentador el√©ctrico",
                    "Conexionado circuito agua caliente",
                    "Aislamiento de tuber√≠as",
                    "Regulaci√≥n de temperatura",
                    "Pruebas de funcionamiento y seguridad"
                ]
            },
            {
                nombre: "F6: El Trono del Rey",
                criterios: [
                    "Instalaci√≥n de inodoro completo",
                    "Nivelaci√≥n y fijaci√≥n a suelo/pared",
                    "Conexionado de entrada y desag√ºe",
                    "Pruebas de descarga y estanqueidad",
                    "Colocaci√≥n de tapa y accesorios"
                ]
            },
            {
                nombre: "F7: Bajo Presi√≥n",
                criterios: [
                    "Pruebas de presi√≥n del sistema",
                    "Detecci√≥n y reparaci√≥n de fugas",
                    "Verificaci√≥n de v√°lvulas de seguridad",
                    "Comprobaci√≥n de caudal en puntos",
                    "Documentaci√≥n de pruebas realizadas"
                ]
            },
            {
                nombre: "F8: Coordinaci√≥n Perfecta",
                criterios: [
                    "Coordinaci√≥n con instalaci√≥n el√©ctrica",
                    "Respeto de espacios para otros oficios",
                    "Planificaci√≥n conjunta de rutas",
                    "Comunicaci√≥n con equipo de obra",
                    "Soluci√≥n de interferencias"
                ]
            },
            {
                nombre: "F9: Fontanero-Electricista",
                criterios: [
                    "Instalaci√≥n de elementos mixtos",
                    "Coordinaci√≥n para puntos de agua caliente",
                    "Montaje de aparatos con conexi√≥n el√©ctrica",
                    "Respeto de normativas conjuntas",
                    "Integraci√≥n de sistemas"
                ]
            },
            {
                nombre: "F10: MI PRIMER BA√ëO COMPLETO",
                criterios: [
                    "Instalaci√≥n completa de fontaner√≠a en ba√±o",
                    "Montaje de todos los sanitarios",
                    "Sistema completo de desag√ºe",
                    "Pruebas integrales de funcionamiento",
                    "Limpieza y entrega final"
                ]
            }
        ];

        const actividadesCarpinteriaNuevas = [
            {
                nombre: "C1: El Detective de Planos",
                criterios: [
                    "Interpretaci√≥n correcta de documentaci√≥n t√©cnica",
                    "Identificaci√≥n de cotas y medidas",
                    "Comprensi√≥n de s√≠mbolos y leyendas",
                    "Extracci√≥n de informaci√≥n relevante",
                    "Preparaci√≥n de lista de materiales"
                ]
            },
            {
                nombre: "C2: El Almac√©n Perfecto",
                criterios: [
                    "Organizaci√≥n de materiales en almac√©n",
                    "Transporte seguro de materiales",
                    "Clasificaci√≥n por tipos y usos",
                    "Control de existencias",
                    "Mantenimiento del orden y limpieza"
                ]
            },
            {
                nombre: "C3: Replanteo: El Arte de Marcar",
                criterios: [
                    "Transferencia de medidas del plano a realidad",
                    "Uso de herramientas de marcaje",
                    "Verificaci√≥n de √°ngulos y escuadrados",
                    "Marcaje preciso en diferentes superficies",
                    "Ajuste de medidas seg√∫n condiciones reales"
                ]
            },
            {
                nombre: "C4: Mi Primer Suelo Flotante",
                criterios: [
                    "Preparaci√≥n de subbase nivelada",
                    "Instalaci√≥n de barrera de vapor",
                    "Colocaci√≥n de paneles con junta desplazada",
                    "Montaje de perfiles y transiciones",
                    "Acabado final y limpieza"
                ]
            },
            {
                nombre: "C5: Maestro del Z√≥calo",
                criterios: [
                    "Medici√≥n y corte preciso de z√≥calos",
                    "Ajuste en esquinas internas y externas",
                    "Fijaci√≥n correcta a pared",
                    "Acabado de juntas y encuentros",
                    "Limpieza y protecci√≥n final"
                ]
            },
            {
                nombre: "C6: El Premarco Perfecto",
                criterios: [
                    "Instalaci√≥n de premarcos para puertas",
                    "Nivelaci√≥n y aplomado preciso",
                    "Fijaci√≥n estructural correcta",
                    "Preparaci√≥n para bisagras",
                    "Acabado y masillado de juntas"
                ]
            },
            {
                nombre: "C7: Colgando Puertas como un Pro",
                criterios: [
                    "Montaje de bisagras y herrajes",
                    "Colocaci√≥n y ajuste de puertas",
                    "Instalaci√≥n de mecanismos de cierre",
                    "Ajuste de holguras y funcionamiento",
                    "Acabado final y lubricaci√≥n"
                ]
            },
            {
                nombre: "C8: Armario Empotrado Paso a Paso",
                criterios: [
                    "Dise√±o y planificaci√≥n del armario",
                    "Montaje de estructura principal",
                    "Instalaci√≥n de estantes y barras",
                    "Colocaci√≥n de puertas y frontales",
                    "Ajustes finales y acabados"
                ]
            },
            {
                nombre: "C9: Cocina Completa: De Cero a Chef",
                criterios: [
                    "Instalaci√≥n de mobiliario de cocina",
                    "Montaje de encimeras y z√≥calos",
                    "Ajuste de puertas y cajones",
                    "Instalaci√≥n de electrodom√©sticos integrados",
                    "Acabado final y limpieza"
                ]
            },
            {
                nombre: "C10: MI PRIMERA HABITACI√ìN COMPLETA",
                criterios: [
                    "Instalaci√≥n completa de suelo flotante",
                    "Montaje de todo el mobiliario",
                    "Colocaci√≥n de puertas y z√≥calos",
                    "Integraci√≥n de todos los elementos",
                    "Limpieza y entrega final"
                ]
            }
        ];

        const actividadesAlbanileriaNuevas = [
            {
                nombre: "A1: Inspector de Obra - Mi Primera Visita",
                criterios: [
                    "Interpretaci√≥n de planos y documentaci√≥n",
                    "Realizaci√≥n de croquis y mediciones",
                    "Identificaci√≥n de elementos constructivos",
                    "Toma de datos en campo",
                    "Preparaci√≥n de informe de visita"
                ]
            },
            {
                nombre: "A2: El Alquimista de los Morteros",
                criterios: [
                    "Dosificaci√≥n correcta de componentes",
                    "Mezclado homog√©neo de morteros",
                    "Control de consistencia y trabajabilidad",
                    "Preparaci√≥n de pastas de agarre",
                    "Limpieza y mantenimiento de herramientas"
                ]
            },
            {
                nombre: "A3: Levantando Paredes - El Muro Perfecto",
                criterios: [
                    "Asentado de hiladas niveladas",
                    "Control de plomos y escuadras",
                    "Llenado completo de juntas",
                    "Ejecuci√≥n de encuentros y esquinas",
                    "Acabado superficial del muro"
                ]
            },
            {
                nombre: "A4: Tabiquer√≠a Seca - R√°pido y Limpio",
                criterios: [
                    "Montaje de estructura met√°lica",
                    "Colocaci√≥n de placas de yeso",
                    "Fijaci√≥n correcta y estanca",
                    "Preparaci√≥n para instalaciones",
                    "Acabado de juntas entre placas"
                ]
            },
            {
                nombre: "A5: El Cirujano de la Pared - Rozas Perfectas",
                criterios: [
                    "Marcaje preciso de rozas",
                    "Ejecuci√≥n de cortes limpios",
                    "Respeto de profundidades y anchos",
                    "Preparaci√≥n para tubos y conducciones",
                    "Relleno y acabado posterior"
                ]
            },
            {
                nombre: "A6: Paredes Listas para Pintar - El Arte del Yeso",
                criterios: [
                    "Aplicaci√≥n de capa de agarre",
                    "Extendido y regleado de yeso",
                    "Alisado superficial perfecto",
                    "Control de espesores uniformes",
                    "Acabado listo para pintura"
                ]
            },
            {
                nombre: "A7: El Maestro del Enfoscado - Paredes Exteriores",
                criterios: [
                    "Preparaci√≥n de paramento exterior",
                    "Aplicaci√≥n de enfoscado de cemento",
                    "Regleado y alisado de capa",
                    "Texturizado superficial adecuado",
                    "Curado y protecci√≥n del enfoscado"
                ]
            },
            {
                nombre: "A8: Alicatando el Ba√±o Perfecto",
                criterios: [
                    "Planeado de distribuci√≥n de azulejos",
                    "Corte preciso de piezas",
                    "Aplicaci√≥n de adhesivo cer√°mico",
                    "Colocaci√≥n con junta uniforme",
                    "Rejuntado y limpieza final"
                ]
            },
            {
                nombre: "A9: Solando el Sal√≥n - Pavimento Perfecto",
                criterios: [
                    "Preparaci√≥n de solera nivelada",
                    "Tendido de lecho de mortero",
                    "Colocaci√≥n de baldosas niveladas",
                    "Control de juntas y alineaciones",
                    "Limpieza y protecci√≥n final"
                ]
            },
            {
                nombre: "A10: MI PRIMER BA√ëO COMPLETO - De Obra a Joya",
                criterios: [
                    "Ejecuci√≥n completa de alba√±iler√≠a en ba√±o",
                    "Tabiquer√≠a y revestimientos",
                    "Solado y alicatado integral",
                    "Preparaci√≥n para otros oficios",
                    "Limpieza y entrega final"
                ]
            },
            {
                nombre: "TAB1: Pladur Pro - Tabiques Completos con Aislamiento",
                criterios: [
                    "Montaje de estructura met√°lica",
                    "Colocaci√≥n de placas de yeso laminado",
                    "Instalaci√≥n de material aislante",
                    "Fijaci√≥n correcta y estanca",
                    "Acabado de juntas y preparaci√≥n para pintura"
                ]
            },
            {
                nombre: "TAB2: Techos Suspendidos - El Quinto Plano",
                criterios: [
                    "Instalaci√≥n de estructura de techo suspendido",
                    "Nivelaci√≥n precisa del falso techo",
                    "Colocaci√≥n de placas de yeso",
                    "Integraci√≥n de puntos de luz",
                    "Acabado de juntas y esquinas"
                ]
            },
            {
                nombre: "PINT1: Preparando el Lienzo - Acabados Previos",
                criterios: [
                    "Limpieza y preparaci√≥n de superficies",
                    "Aplicaci√≥n de imprimaciones",
                    "Relleno de grietas y agujeros",
                    "Lijado uniforme de paredes",
                    "Protecci√≥n de elementos no pintables"
                ]
            },
            {
                nombre: "PINT2: Pintando Profesionalmente - Temple y Pl√°stica",
                criterios: [
                    "Mezclado correcto de pinturas",
                    "Aplicaci√≥n de primera mano uniforme",
                    "T√©cnica de pintado sin marcas",
                    "Aplicaci√≥n de segunda mano perfecta",
                    "Limpieza de herramientas y √°rea"
                ]
            },
            {
                nombre: "PINT3: El Arte del Detalle - Esmaltes y Decoraci√≥n",
                criterios: [
                    "Pintura de carpinter√≠as y molduras",
                    "Aplicaci√≥n de esmaltes y barnices",
                    "T√©cnicas de efectos decorativos",
                    "Acabado perfecto en detalles",
                    "Protecci√≥n y limpieza final"
                ]
            }
        ];

        const aspectosData = [
            {
                categoria: 'actitudinales',
                titulo: 'üë§ Actitudinales',
                items: [
                    {
                        nombre: 'Puntualidad',
                        opciones: ['', '‚è∞ A la hora', 'üïê Retraso 5-10m', '‚è≥ Tarde +10m', '‚ùå Falta just', '‚õî Falta no just']
                    },
                    {
                        nombre: 'Actitud',
                        opciones: ['', 'üåü Proactivo', '‚úÖ Positiva', 'üòê Pasivo', 'üòû Desmotivado', '‚ûñ No observado']
                    },
                    {
                        nombre: 'Trabajo equipo',
                        opciones: ['', 'ü§ù Colabora', '‚úÖ Bien', 'üôã Solo', '‚ö†Ô∏è Conflictos', '‚ûñ No observado']
                    }
                ]
            },
            {
                categoria: 'progreso',
                titulo: 'üìà Progreso',
                items: [
                    {
                        nombre: 'Evoluci√≥n',
                        opciones: ['', 'üöÄ Mejora notable', '‚úÖ Al ritmo', 'üêå Lento', 'üîÑ Estancado', '‚ûñ No observado']
                    },
                    {
                        nombre: 'Autonom√≠a',
                        opciones: ['', 'üí™ Independiente', '‚úÖ Poca super', 'üôã Pregunta mucho', 'üë®‚Äçüè´ Acompa√±amiento', '‚ûñ No observado']
                    },
                    {
                        nombre: 'Resoluci√≥n problemas',
                        opciones: ['', 'üß© Solo', '‚úÖ Con ayuda', 'ü§î Se bloquea', 'üÜò No sabe', '‚ûñ No observado']
                    }
                ]
            }
        ];

        // Sistema de almacenamiento
        const storage = {
            get: function(key) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch(e) {
                    console.error('Error al leer:', e);
                    return null;
                }
            },
            set: function(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                    return true;
                } catch(e) {
                    console.error('Error al guardar:', e);
                    return false;
                }
            }
        };

        // Inicializaci√≥n
        window.onload = function() {
            cargarDatos();
        };

        function cargarDatos() {
            const data = storage.get('seguimiento-rotacion-v1');
            if (data) {
                alumnos = data.alumnos || [];
                notas = data.notas || {};
                tareas = data.tareas || [];
            }
            renderizar();
        }

        function guardarDatos() {
            storage.set('seguimiento-rotacion-v1', {
                alumnos: alumnos,
                notas: notas,
                tareas: tareas
            });
        }

        function cargarTodasActividades() {
            if (confirm('¬øCargar TODAS las actividades originales y nuevas? Esto a√±adir√° 73 actividades.')) {
                let totalAgregadas = 0;
                
                // Cargar actividades por taller
                const todosTalleres = [
                    { 
                        taller: 'Electricidad', 
                        originales: actividadesElectricidadOriginal, 
                        nuevas: actividadesElectricidadNuevas 
                    },
                    { 
                        taller: 'Fontaner√≠a', 
                        originales: actividadesFontaneriaOriginal, 
                        nuevas: actividadesFontaneriaNuevas 
                    },
                    { 
                        taller: 'Carpinter√≠a', 
                        originales: actividadesCarpinteriaOriginal, 
                        nuevas: actividadesCarpinteriaNuevas 
                    },
                    { 
                        taller: 'Alba√±iler√≠a', 
                        originales: actividadesAlbanileriaOriginal, 
                        nuevas: actividadesAlbanileriaNuevas 
                    }
                ];

                todosTalleres.forEach(tallerData => {
                    // Cargar originales
                    tallerData.originales.forEach(act => {
                        const existe = tareas.find(t => t.nombre === act.nombre && t.taller === tallerData.taller);
                        if (!existe) {
                            tareas.push({
                                id: Date.now() + totalAgregadas,
                                taller: tallerData.taller,
                                nombre: act.nombre,
                                criterios: act.criterios,
                                tipo: 'original'
                            });
                            totalAgregadas++;
                        }
                    });

                    // Cargar nuevas
                    tallerData.nuevas.forEach(act => {
                        const existe = tareas.find(t => t.nombre === act.nombre && t.taller === tallerData.taller);
                        if (!existe) {
                            tareas.push({
                                id: Date.now() + totalAgregadas,
                                taller: tallerData.taller,
                                nombre: act.nombre,
                                criterios: act.criterios,
                                tipo: 'nueva'
                            });
                            totalAgregadas++;
                        }
                    });
                });

                guardarDatos();
                alert(`‚úÖ Se han agregado ${totalAgregadas} actividades:\n‚Ä¢ Electricidad: 10 originales + 10 nuevas\n‚Ä¢ Fontaner√≠a: 8 originales + 10 nuevas\n‚Ä¢ Carpinter√≠a: 8 originales + 10 nuevas\n‚Ä¢ Alba√±iler√≠a: 8 originales + 15 nuevas`);
                renderizarTareas();
            }
        }

        // ... (el resto de las funciones se mantienen igual)
        function crearSeguimiento() {
            const seg = {};
            for (let s = 1; s <= 4; s++) {
                seg['s' + s] = {
                    taller: null,
                    tareaAsignada: null,
                    dias: {}
                };
                for (let d = 1; d <= 5; d++) {
                    seg['s' + s].dias['d' + d] = {
                        tarea: {},
                        actitudinales: {},
                        progreso: {}
                    };
                    
                    aspectosData.forEach(cat => {
                        cat.items.forEach((item, idx) => {
                            seg['s' + s].dias['d' + d][cat.categoria][idx] = '';
                        });
                    });
                }
            }
            return seg;
        }

        function toggleFormNuevo() {
            const form = document.getElementById('form-nuevo');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        function toggleFormTareas() {
            const form = document.getElementById('form-tareas');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
            if (form.style.display === 'block') {
                renderizarTareas();
            }
        }

        function toggleTareasContent() {
            tareasExpanded = !tareasExpanded;
            const content = document.getElementById('tareas-content');
            const arrow = document.getElementById('tareas-arrow');
            content.classList.toggle('expanded');
            arrow.textContent = tareasExpanded ? '‚ñ≤' : '‚ñº';
        }

        function toggleFormNuevaTarea() {
            const form = document.getElementById('form-nueva-tarea');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
            if (form.style.display === 'block') {
                document.getElementById('nueva-tarea-nombre').value = '';
                const inputs = document.querySelectorAll('.criterio-input');
                inputs.forEach(inp => inp.value = '');
            }
        }

        function agregarCriterioInput() {
            const container = document.getElementById('criterios-inputs');
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'criterio-input';
            input.placeholder = 'Criterio ' + (container.children.length + 1);
            container.appendChild(input);
        }

        function guardarTarea() {
            const taller = document.getElementById('nueva-tarea-taller').value;
            const nombre = document.getElementById('nueva-tarea-nombre').value.trim();
            const inputs = document.querySelectorAll('.criterio-input');
            const criterios = [];
            inputs.forEach(inp => {
                if (inp.value.trim()) {
                    criterios.push(inp.value.trim());
                }
            });

            if (!nombre) {
                alert('Por favor, ingresa un nombre para la tarea');
                return;
            }

            if (criterios.length === 0) {
                alert('Por favor, a√±ade al menos un criterio de evaluaci√≥n');
                return;
            }

            tareas.push({
                id: Date.now(),
                taller: taller,
                nombre: nombre,
                criterios: criterios,
                tipo: 'manual'
            });

            guardarDatos();
            toggleFormNuevaTarea();
            renderizarTareas();
        }

        function eliminarTarea(id) {
            if (confirm('Eliminar esta tarea?')) {
                tareas = tareas.filter(t => t.id !== id);
                guardarDatos();
                renderizarTareas();
            }
        }

        function renderizarTareas() {
            const lista = document.getElementById('lista-tareas');
            
            if (tareas.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 20px;">No hay tareas. Haz clic en "Cargar Todas" para cargar actividades predefinidas.</p>';
                return;
            }

            // Agrupar tareas por taller
            const tareasPorTaller = {};
            talleres.forEach(t => tareasPorTaller[t] = []);
            tareas.forEach(t => {
                if (tareasPorTaller[t.taller]) {
                    tareasPorTaller[t.taller].push(t);
                }
            });

            lista.innerHTML = talleres.map(taller => {
                const tareasDelTaller = tareasPorTaller[taller];
                if (tareasDelTaller.length === 0) return '';
                
                // Separar por tipo
                const originales = tareasDelTaller.filter(t => t.tipo === 'original');
                const nuevas = tareasDelTaller.filter(t => t.tipo === 'nueva');
                const manuales = tareasDelTaller.filter(t => t.tipo === 'manual');
                
                return `
                    <div class="taller-group">
                        <div class="taller-header">
                            <div class="taller-titulo">üîß ${taller}</div>
                            <div style="color: #6b7280; font-size: 13px;">${tareasDelTaller.length} tareas</div>
                        </div>
                        
                        ${originales.length > 0 ? `
                            <div class="desplegable-tipo">
                                <div class="desplegable-header" onclick="toggleDesplegable(this)">
                                    <span>üìö Actividades Originales (${originales.length})</span>
                                    <span>‚ñº</span>
                                </div>
                                <div class="desplegable-content">
                                    ${originales.map(t => `
                                        <div class="tarea-item">
                                            <div class="tarea-titulo">
                                                <span>${t.nombre}</span>
                                                <button class="btn btn-danger btn-small" onclick="eliminarTarea(${t.id})">üóëÔ∏è</button>
                                            </div>
                                            <div class="tarea-criterios">
                                                ${t.criterios.map(c => `<span class="criterio-tag">${c}</span>`).join('')}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${nuevas.length > 0 ? `
                            <div class="desplegable-tipo">
                                <div class="desplegable-header" onclick="toggleDesplegable(this)">
                                    <span>üÜï Actividades Nuevas (${nuevas.length})</span>
                                    <span>‚ñº</span>
                                </div>
                                <div class="desplegable-content">
                                    ${nuevas.map(t => `
                                        <div class="tarea-item">
                                            <div class="tarea-titulo">
                                                <span>${t.nombre}</span>
                                                <button class="btn btn-danger btn-small" onclick="eliminarTarea(${t.id})">üóëÔ∏è</button>
                                            </div>
                                            <div class="tarea-criterios">
                                                ${t.criterios.map(c => `<span class="criterio-tag">${c}</span>`).join('')}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${manuales.length > 0 ? `
                            <div class="desplegable-tipo">
                                <div class="desplegable-header" onclick="toggleDesplegable(this)">
                                    <span>‚úèÔ∏è Actividades Manuales (${manuales.length})</span>
                                    <span>‚ñº</span>
                                </div>
                                <div class="desplegable-content">
                                    ${manuales.map(t => `
                                        <div class="tarea-item">
                                            <div class="tarea-titulo">
                                                <span>${t.nombre}</span>
                                                <button class="btn btn-danger btn-small" onclick="eliminarTarea(${t.id})">üóëÔ∏è</button>
                                            </div>
                                            <div class="tarea-criterios">
                                                ${t.criterios.map(c => `<span class="criterio-tag">${c}</span>`).join('')}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function toggleDesplegable(element) {
            const content = element.nextElementSibling;
            const arrow = element.querySelector('span:last-child');
            content.classList.toggle('expanded');
            arrow.textContent = content.classList.contains('expanded') ? '‚ñ≤' : '‚ñº';
        }

        function agregarAlumno() {
            const nombre = document.getElementById('nombre-nuevo').value.trim();

            if (!nombre) return;

            alumnos.push({
                id: Date.now(),
                nombre: nombre,
                seg: crearSeguimiento()
            });

            document.getElementById('nombre-nuevo').value = '';
            guardarDatos();
            renderizar();
            toggleFormNuevo();
        }

        function eliminarAlumno(id) {
            if (confirm('Eliminar este alumno y todos sus datos?')) {
                alumnos = alumnos.filter(a => a.id !== id);
                delete notas[id];
                if (seleccionado && seleccionado.id === id) {
                    seleccionado = null;
                }
                guardarDatos();
                renderizar();
            }
        }

        function seleccionarAlumno(id) {
            seleccionado = alumnos.find(a => a.id === id);
            semanaActual = 1;
            renderizar();
        }

        function cambiarSemana(s) {
            semanaActual = s;
            renderizar();
        }

        function toggleCategoria(cat) {
            categoriaExpandida = categoriaExpandida === cat ? null : cat;
            renderizar();
        }

        function asignarTaller(taller) {
            if (!seleccionado) return;
            
            const alumno = alumnos.find(a => a.id === seleccionado.id);
            alumno.seg['s' + semanaActual].taller = taller;
            alumno.seg['s' + semanaActual].tareaAsignada = null;
            seleccionado = alumno;
            guardarDatos();
            renderizar();
        }

        function asignarTareaSemana(tareaId) {
            if (!seleccionado) return;
            
            const alumno = alumnos.find(a => a.id === seleccionado.id);
            alumno.seg['s' + semanaActual].tareaAsignada = tareaId ? parseInt(tareaId) : null;
            seleccionado = alumno;
            guardarDatos();
            renderizar();
        }

        function actualizarValor(cat, idx, dia, valor) {
            if (!seleccionado) return;
            
            const alumno = alumnos.find(a => a.id === seleccionado.id);
            alumno.seg['s' + semanaActual].dias['d' + dia][cat][idx] = valor;
            seleccionado = alumno;
            guardarDatos();
        }

        function actualizarTarea(criterioIdx, dia, valor) {
            if (!seleccionado) return;
            
            const alumno = alumnos.find(a => a.id === seleccionado.id);
            alumno.seg['s' + semanaActual].dias['d' + dia].tarea[criterioIdx] = valor;
            seleccionado = alumno;
            guardarDatos();
        }

        function agregarNota() {
            const input = document.getElementById('nota-nueva');
            const texto = input.value.trim();
            
            if (!texto || !seleccionado) return;

            if (!notas[seleccionado.id]) {
                notas[seleccionado.id] = [];
            }

            notas[seleccionado.id].push({
                txt: texto,
                fecha: new Date().toLocaleDateString(),
                sem: semanaActual
            });

            input.value = '';
            guardarDatos();
            renderizar();
        }

        function generarComentario(hastaS) {
            if (!seleccionado) return '';

            const al = seleccionado;
            let txt = al.nombre + '\n';
            txt += (hastaS === 4 ? 'EVALUACI√ìN MENSUAL' : 'SEMANA ' + hastaS) + '\n';
            txt += '='.repeat(60) + '\n\n';

            const conteo = {};
            const rotaciones = [];

            for (let s = 1; s <= hastaS; s++) {
                const semData = al.seg['s' + s];
                if (!semData) continue;

                if (semData.taller) {
                    const tarea = semData.tareaAsignada ? tareas.find(t => t.id === semData.tareaAsignada) : null;
                    rotaciones.push({
                        semana: s,
                        taller: semData.taller,
                        tarea: tarea ? tarea.nombre : 'Sin tarea asignada'
                    });
                }

                Object.values(semData.dias).forEach(diaData => {
                    ['actitudinales', 'progreso', 'tarea'].forEach(cat => {
                        if (diaData[cat]) {
                            Object.values(diaData[cat]).forEach(val => {
                                if (val && val !== '' && !val.includes('No observado')) {
                                    conteo[val] = (conteo[val] || 0) + 1;
                                }
                            });
                        }
                    });
                });
            }

            if (rotaciones.length > 0) {
                txt += 'ROTACI√ìN POR TALLERES:\n';
                rotaciones.forEach(r => {
                    txt += '‚Ä¢ Semana ' + r.semana + ': ' + r.taller + ' - ' + r.tarea + '\n';
                });
                txt += '\n';
            }

            const notasAl = (notas[al.id] || []).filter(n => n.sem <= hastaS);
            let total = 0;
            Object.values(conteo).forEach(v => total += v);

            if (total > 0) {
                txt += 'RESUMEN DE OBSERVACIONES:\n';
                Object.entries(conteo)
                    .sort((a, b) => b[1] - a[1])
                    .forEach(([k, v]) => {
                        txt += '‚Ä¢ ' + k + ': ' + v + ' registros\n';
                    });
                txt += '\n';
            }

            if (notasAl.length > 0) {
                txt += 'NOTAS ADICIONALES DEL FORMADOR:\n';
                notasAl.forEach(n => {
                    txt += '‚Ä¢ ' + n.txt + ' (Semana ' + n.sem + ' - ' + n.fecha + ')\n';
                });
                txt += '\n';
            }

            txt += 'VALORACI√ìN PROFESIONAL Y RECOMENDACIONES:\n';
            txt += '-'.repeat(60) + '\n\n';

            if (total < 10) {
                txt += 'El periodo de observaci√≥n registrado hasta el momento resulta insuficiente para emitir una valoraci√≥n completa y fundamentada del desempe√±o de ' + al.nombre + ' en el sistema de rotaci√≥n por talleres. Se requiere continuar con el seguimiento sistem√°tico durante las pr√≥ximas semanas para poder identificar patrones consistentes de comportamiento, √°reas espec√≠ficas de fortaleza y aspectos susceptibles de mejora en cada uno de los oficios.\n\n';
                txt += 'RECOMENDACIONES INMEDIATAS:\n';
                txt += '‚Ä¢ Mantener la observaci√≥n activa y registro diario en todas las √°reas de evaluaci√≥n durante cada rotaci√≥n.\n';
                txt += '‚Ä¢ Prestar especial atenci√≥n a la capacidad de adaptaci√≥n a diferentes talleres y oficios.\n';
                txt += '‚Ä¢ Monitorear el desarrollo progresivo de habilidades t√©cnicas b√°sicas en cada especialidad.\n';
                txt += '‚Ä¢ Establecer comunicaci√≥n regular para conocer sus preferencias y motivaci√≥n hacia los diferentes oficios.';
            } else {
                const positivos = (conteo['üåü Proactivo'] || 0) + (conteo['üöÄ Mejora notable'] || 0) + 
                                  (conteo['üí™ Independiente'] || 0) + (conteo['‚úÖ Positiva'] || 0) +
                                  (conteo['‚úÖ Excelente'] || 0) + (conteo['üëç Bien'] || 0);
                const atencion = (conteo['üòû Desmotivado'] || 0) + (conteo['üîÑ Estancado'] || 0) + 
                                 (conteo['‚ö†Ô∏è Conflictos'] || 0) + (conteo['‚è≥ Tarde +10m'] || 0) + 
                                 (conteo['‚õî Falta no just'] || 0) + (conteo['‚ö†Ô∏è Dificultad'] || 0);
                
                if (positivos > total * 0.3) {
                    txt += al.nombre + ' est√° demostrando un desempe√±o destacado y comprometido en el sistema de rotaci√≥n por talleres. Los datos recogidos durante el periodo de observaci√≥n evidencian una evoluci√≥n positiva y consistente, con especial menci√≥n a su capacidad de adaptaci√≥n a diferentes entornos de trabajo y oficios. Su actitud proactiva hacia el aprendizaje, disposici√≥n colaborativa y versatilidad demostrada en las distintas especialidades le posicionan como un elemento valioso dentro del grupo.\n\n';
                    txt += 'La capacidad mostrada para asimilar conocimientos diversos y la progresi√≥n t√©cnica observada en m√∫ltiples √°reas permiten anticipar un desarrollo exitoso en el √°mbito de los oficios, con potencial para especializarse en aquellas √°reas donde muestre mayor inter√©s o aptitud natural.\n\n';
                    txt += 'RECOMENDACIONES PARA POTENCIAR EL DESARROLLO:\n';
                    txt += '‚Ä¢ Identificar el o los talleres donde muestra mayor motivaci√≥n y aptitud para orientar su formaci√≥n futura.\n';
                    txt += '‚Ä¢ Fomentar su papel como referente positivo para compa√±eros con m√°s dificultades de adaptaci√≥n.\n';
                    txt += '‚Ä¢ Proponer gradualmente retos t√©cnicos de mayor complejidad en sus √°reas de fortaleza.\n';
                    txt += '‚Ä¢ Reconocer p√∫blicamente su capacidad de adaptaci√≥n y progreso como modelo para el grupo.';
                } else if (atencion > total * 0.3) {
                    txt += 'Los datos recogidos durante el seguimiento de ' + al.nombre + ' en el sistema de rotaci√≥n por talleres revelan la necesidad de implementar un plan de acompa√±amiento m√°s cercano y personalizado. Se han identificado dificultades en la adaptaci√≥n a los diferentes entornos de trabajo, aspectos motivacionales que pueden estar afectando el rendimiento, o desaf√≠os espec√≠ficos en el desarrollo de autonom√≠a y constancia.\n\n';
                    txt += 'El sistema de rotaci√≥n puede resultar especialmente exigente para j√≥venes en proceso de desarraigo, requiriendo una capacidad de adaptaci√≥n constante que no siempre es f√°cil de desarrollar. Es fundamental abordar esta situaci√≥n desde un enfoque integral, identificando si existen oficios espec√≠ficos donde se sienta m√°s c√≥modo o motivado, y trabajando sobre factores personales, sociales o contextuales que puedan estar interfiriendo.\n\n';
                    txt += 'PLAN DE ACCI√ìN RECOMENDADO:\n';
                    txt += '‚Ä¢ Establecer tutor√≠as individuales semanales para crear un espacio de escucha y orientaci√≥n sobre su experiencia en cada taller.\n';
                    txt += '‚Ä¢ Valorar si ser√≠a beneficioso una rotaci√≥n m√°s pausada o centrada en oficios espec√≠ficos que despierten su inter√©s.\n';
                    txt += '‚Ä¢ Investigar de manera emp√°tica factores externos que puedan estar afectando su capacidad de concentraci√≥n y compromiso.\n';
                    txt += '‚Ä¢ Dise√±ar objetivos adaptados a su nivel actual en cada oficio, generando experiencias de √©xito que fortalezcan su autoconfianza.\n';
                    txt += '‚Ä¢ Coordinar con el equipo educativo estrategias de apoyo espec√≠ficas y considerar la posibilidad de acompa√±amiento especializado.';
                } else {
                    txt += al.nombre + ' est√° progresando de manera adecuada en el sistema de rotaci√≥n por talleres, mostrando un desempe√±o que se ajusta a los objetivos formativos establecidos para esta fase exploratoria. Se observa regularidad en aspectos fundamentales como asistencia y actitud general, as√≠ como un desarrollo gradual de competencias b√°sicas en los diferentes oficios trabajados.\n\n';
                    txt += 'El ritmo de aprendizaje y adaptaci√≥n es apropiado para el contexto de rotaci√≥n, y no se detectan dificultades significativas que requieran intervenci√≥n especial. Con el acompa√±amiento habitual del equipo formativo y manteniendo las condiciones actuales, se espera que el alumno vaya definiendo gradualmente sus preferencias y fortalezas hacia uno o varios oficios espec√≠ficos.\n\n';
                    txt += 'RECOMENDACIONES PARA CONSOLIDAR EL APRENDIZAJE:\n';
                    txt += '‚Ä¢ Mantener el seguimiento regular, observando en qu√© talleres muestra mayor motivaci√≥n o facilidad natural.\n';
                    txt += '‚Ä¢ Dialogar con el alumno sobre su experiencia en cada oficio para identificar sus preferencias e intereses.\n';
                    txt += '‚Ä¢ Reforzar aquellas √°reas donde muestre mayor inter√©s para ayudarle en su proceso de orientaci√≥n vocacional.\n';
                    txt += '‚Ä¢ Proponer peque√±os desaf√≠os en cada taller para estimular su desarrollo sin generar presi√≥n contraproducente.';
                }
            }

            txt += '\n\n' + '='.repeat(60);
            txt += '\nComentario generado el ' + new Date().toLocaleDateString();

            return txt;
        }

        function mostrarComentario(hastaS) {
            const texto = generarComentario(hastaS);
            document.getElementById('texto-comentario').textContent = texto;
            document.getElementById('modal-comentario').classList.add('show');
        }

        function cerrarModal() {
            document.getElementById('modal-comentario').classList.remove('show');
        }

        function copiarComentario() {
            const texto = document.getElementById('texto-comentario').textContent;
            navigator.clipboard.writeText(texto).then(() => {
                alert('‚úÖ Comentario copiado al portapapeles');
            });
        }

        function exportar() {
            if (alumnos.length === 0) return;

            let contenido = 'EVALUACIONES MENSUALES - ROTACI√ìN DE TALLERES\n';
            contenido += 'Generado el: ' + new Date().toLocaleDateString() + '\n';
            contenido += '='.repeat(80) + '\n\n\n';

            alumnos.forEach(alumno => {
                seleccionado = alumno;
                contenido += generarComentario(4);
                contenido += '\n\n\n' + '='.repeat(80) + '\n\n\n';
            });

            const blob = new Blob([contenido], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'evaluaciones_rotacion_' + new Date().toISOString().split('T')[0] + '.txt';
            link.click();
            URL.revokeObjectURL(url);
        }

        function renderizar() {
            document.getElementById('contador-alumnos').textContent = alumnos.length + ' alumnos';
            document.getElementById('btn-exportar').disabled = alumnos.length === 0;

            const listaAlumnos = document.getElementById('lista-alumnos');
            if (alumnos.length === 0) {
                listaAlumnos.innerHTML = '<p style="text-align: center; color: #9ca3af; padding: 20px; font-size: 13px;">No hay alumnos</p>';
            } else {
                listaAlumnos.innerHTML = alumnos.map(a => `
                    <button class="alumno-btn ${seleccionado && seleccionado.id === a.id ? 'active' : ''}"
                            onclick="seleccionarAlumno(${a.id})">
                        ${a.nombre}
                    </button>
                `).join('');
            }

            const contentArea = document.getElementById('content-area');
            
            if (!seleccionado) {
                contentArea.innerHTML = `
                    <div class="content-area">
                        <div class="placeholder">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <p>Selecciona un alumno para comenzar el seguimiento</p>
                        </div>
                    </div>
                `;
                return;
            }

            const tallerAsignado = seleccionado.seg['s' + semanaActual].taller;
            const tareaAsignada = seleccionado.seg['s' + semanaActual].tareaAsignada;
            const tareaObj = tareaAsignada ? tareas.find(t => t.id === tareaAsignada) : null;
            const tareasDelTaller = tallerAsignado ? tareas.filter(t => t.taller === tallerAsignado) : [];

            let html = `
                <div>
                    <div class="content-area">
                        <div class="alumno-header">
                            <div class="alumno-info">
                                <h2>${seleccionado.nombre}</h2>
                                <p>Sistema de Rotaci√≥n por Talleres</p>
                            </div>
                            <button class="btn btn-delete" onclick="eliminarAlumno(${seleccionado.id})">üóëÔ∏è Eliminar</button>
                        </div>

                        ${tareas.length === 0 ? '<div class="info-banner">üí° <strong>Tip:</strong> Haz clic en "Cargar Todas" para cargar actividades predefinidas con sus criterios de evaluaci√≥n.</div>' : ''}

                        <div class="semanas-nav">
                            ${[1,2,3,4].map(s => `
                                <button class="semana-btn ${semanaActual === s ? 'active' : ''}" 
                                        onclick="cambiarSemana(${s})">
                                    Semana ${s}
                                </button>
                            `).join('')}
                        </div>

                        <div class="dias-header">
                            ${[1,2,3,4,5].map(d => `<div class="dia-label">D√≠a ${d}</div>`).join('')}
                        </div>

                        <div class="rotacion-section">
                            <label class="rotacion-label">üîÑ Taller de esta semana:</label>
                            <select class="rotacion-select" onchange="asignarTaller(this.value)">
                                <option value="">-- Seleccionar taller --</option>
                                ${talleres.map(t => `
                                    <option value="${t}" ${tallerAsignado === t ? 'selected' : ''}>
                                        ${t}
                                    </option>
                                `).join('')}
                            </select>

                            ${tallerAsignado && tareasDelTaller.length > 0 ? `
                                <div class="tarea-select-section">
                                    <label class="tarea-select-label">üìã Tarea/Actividad asignada:</label>
                                    <select class="tarea-select" onchange="asignarTareaSemana(this.value)">
                                        <option value="">-- Sin tarea --</option>
                                        ${tareasDelTaller.map(t => `
                                            <option value="${t.id}" ${tareaAsignada === t.id ? 'selected' : ''}>
                                                ${t.nombre}
                                            </option>
                                        `).join('')}
                                    </select>
                                </div>
                            ` : tallerAsignado ? '<p style="text-align: center; color: #92400e; margin-top: 10px; font-size: 13px;">‚ö†Ô∏è No hay tareas para este taller. Carga actividades o cr√©alas manualmente.</p>' : ''}
                        </div>

                        ${!tallerAsignado ? '<div style="text-align: center; padding: 20px; color: #6b7280; background: #fef3c7; border-radius: 8px; margin-bottom: 15px;">‚ö†Ô∏è Selecciona el taller de esta semana para continuar</div>' : ''}

                        ${tareaObj ? `
                            <div class="categoria">
                                <div class="categoria-header" onclick="toggleCategoria('tarea')">
                                    <span>üîß ${tareaObj.nombre}</span>
                                    <span>${categoriaExpandida === 'tarea' ? '‚ñº' : '‚ñ∂'}</span>
                                </div>
                                <div class="categoria-content ${categoriaExpandida === 'tarea' ? 'expanded' : ''}">
                                    ${tareaObj.criterios.map((criterio, idx) => `
                                        <div class="aspecto">
                                            <div class="aspecto-nombre">${criterio}</div>
                                            <div class="aspecto-dias">
                                                ${[1,2,3,4,5].map(d => `
                                                    <select onchange="actualizarTarea(${idx}, ${d}, this.value)">
                                                        <option value="">-</option>
                                                        <option value="‚úÖ Excelente" ${seleccionado.seg['s' + semanaActual].dias['d' + d].tarea[idx] === '‚úÖ Excelente' ? 'selected' : ''}>‚úÖ Excelente</option>
                                                        <option value="üëç Bien" ${seleccionado.seg['s' + semanaActual].dias['d' + d].tarea[idx] === 'üëç Bien' ? 'selected' : ''}>üëç Bien</option>
                                                        <option value="üîß En proceso" ${seleccionado.seg['s' + semanaActual].dias['d' + d].tarea[idx] === 'üîß En proceso' ? 'selected' : ''}>üîß En proceso</option>
                                                        <option value="‚ö†Ô∏è Dificultad" ${seleccionado.seg['s' + semanaActual].dias['d' + d].tarea[idx] === '‚ö†Ô∏è Dificultad' ? 'selected' : ''}>‚ö†Ô∏è Dificultad</option>
                                                        <option value="‚ûñ No observado" ${seleccionado.seg['s' + semanaActual].dias['d' + d].tarea[idx] === '‚ûñ No observado' ? 'selected' : ''}>‚ûñ No observado</option>
                                                    </select>
                                                `).join('')}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        ${aspectosData.map(cat => `
                            <div class="categoria">
                                <div class="categoria-header" onclick="toggleCategoria('${cat.categoria}')">
                                    <span>${cat.titulo}</span>
                                    <span>${categoriaExpandida === cat.categoria ? '‚ñº' : '‚ñ∂'}</span>
                                </div>
                                <div class="categoria-content ${categoriaExpandida === cat.categoria ? 'expanded' : ''}">
                                    ${cat.items.map((item, idx) => `
                                        <div class="aspecto">
                                            <div class="aspecto-nombre">${item.nombre}</div>
                                            <div class="aspecto-dias">
                                                ${[1,2,3,4,5].map(d => `
                                                    <select onchange="actualizarValor('${cat.categoria}', ${idx}, ${d}, this.value)">
                                                        ${item.opciones.map(op => `
                                                            <option value="${op}" ${seleccionado.seg['s' + semanaActual].dias['d' + d][cat.categoria][idx] === op ? 'selected' : ''}>
                                                                ${op || '-'}
                                                            </option>
                                                        `).join('')}
                                                    </select>
                                                `).join('')}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="notas-section">
                        <h3>üìù Notas adicionales</h3>
                        <div class="notas-input">
                            <input type="text" id="nota-nueva" placeholder="A√±adir una nota..." 
                                   onkeypress="if(event.key==='Enter')agregarNota()">
                            <button class="btn btn-primary" onclick="agregarNota()">A√±adir</button>
                        </div>
                        <div class="notas-lista">
                            ${(notas[seleccionado.id] || []).map(n => `
                                <div class="nota-item">
                                    <div>${n.txt}</div>
                                    <div class="nota-fecha">Semana ${n.sem} - ${n.fecha}</div>
                                </div>
                            `).join('') || '<p style="text-align: center; color: #6b7280;">No hay notas registradas</p>'}
                        </div>
                    </div>

                    <div class="comentarios-section">
                        <div class="comentarios-btns">
                            <button class="btn-comentario" onclick="mostrarComentario(${semanaActual})">
                                üìÑ Comentario Semana ${semanaActual}
                            </button>
                            <button class="btn-comentario mensual" onclick="mostrarComentario(4)">
                                üìã Comentario Mensual
                            </button>
                        </div>
                    </div>
                </div>
            `;

            contentArea.innerHTML = html;
        }
    </script>
</body>
</html>
